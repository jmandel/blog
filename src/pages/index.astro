---
import Layout from '../layouts/Layout.astro';
import { getCollection } from 'astro:content';

const posts = await getCollection('blog');
const sortedPosts = posts.sort((a, b) => new Date(b.data.date).getTime() - new Date(a.data.date).getTime());

function formatDate(date: Date | string): string {
  const d = new Date(date);
  return d.toLocaleDateString('en-US', {
    year: 'numeric',
    month: 'long',
    day: 'numeric'
  });
}

function getExcerpt(content: string): string {
  // Extract first paragraph from content, remove HTML tags
  const firstParagraph = content.split('\n').find(line => line.trim().length > 0) || '';
  return firstParagraph.replace(/<[^>]*>/g, '').substring(0, 200) + '...';
}
---

<Layout title="Healthcare Technology Blog">
  <h1 class="text-2xl font-bold text-slate-900 mb-8">Recent Posts</h1>
  <ul class="post-list">
    {sortedPosts.map((post) => (
      <li class="post-item">
        <h2 class="post-title">
          <a href={`/blog/posts/${post.slug}`}>{post.data.title}</a>
        </h2>
        <div class="post-date">{formatDate(post.data.date)}</div>
        <div class="post-excerpt">{getExcerpt(post.body)}</div>
      </li>
    ))}
  </ul>
</Layout>